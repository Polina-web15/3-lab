<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—É–¥–µ–Ω—Ç–∞–º–∏</title>
    <style>
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            margin: 20px; 
            background: #f5f7fa; 
            color: #333;
        }
        h1 { 
            color: #2c3e50; 
            border-bottom: 2px solid #3498db; 
            padding-bottom: 8px; 
            margin-bottom: 25px;
        }
        .form-group {
            display: flex;
            gap: 12px;
            align-items: center;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        input[type="text"] {
            padding: 10px;
            border: 1px solid #bdc3c7;
            border-radius: 6px;
            width: 220px;
            font-size: 14px;
        }
        button {
            padding: 10px 18px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.2s;
        }
        .add-btn {
            background: #3498db;
            color: white;
        }
        .add-btn:hover {
            background: #2980b9;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            box-shadow: 0 4px 10px rgba(0,0,0,0.08);
            border-radius: 8px;
            overflow: hidden;
        }
        th, td {
            padding: 14px;
            text-align: left;
            border-bottom: 1px solid #ecf0f1;
        }
        th {
            background-color: #2c3e50;
            color: white;
            font-weight: bold;
        }
        tr:hover {
            background-color: #f8f9fa;
        }
        .actions button {
            margin-right: 6px;
            padding: 6px 12px;
            font-size: 13px;
            border-radius: 4px;
        }
        .edit-btn {
            background: #f39c12;
            color: white;
        }
        .edit-btn:hover {
            background: #e67e22;
        }
        .delete-btn {
            background: #e74c3c;
            color: white;
        }
        .delete-btn:hover {
            background: #c0392b;
        }
        .message {
            margin-top: 12px;
            padding: 10px;
            border-radius: 6px;
            display: none;
            max-width: 500px;
        }
        .success { 
            background: #d5f5e3; 
            color: #27ae60; 
            border: 1px solid #abebc6;
        }
        .error { 
            background: #fadbd8; 
            color: #c0392b; 
            border: 1px solid #f5b7b1;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéì –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—É–¥–µ–Ω—Ç–∞–º–∏</h1>

        <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è -->
        <div class="form-group">
            <input type="text" id="newName" placeholder="–ò–º—è —Å—Ç—É–¥–µ–Ω—Ç–∞" />
            <input type="text" id="newGroup" placeholder="–ì—Ä—É–ø–ø–∞" />
            <button class="add-btn" onclick="createStudent()">‚ûï –î–æ–±–∞–≤–∏—Ç—å</button>
        </div>
        <div id="createMessage" class="message"></div>

        <!-- –¢–∞–±–ª–∏—Ü–∞ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ -->
        <table id="studentsTable">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>–ò–º—è</th>
                    <th>–ì—Ä—É–ø–ø–∞</th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
            </thead>
            <tbody id="studentsBody">
                <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è JS -->
            </tbody>
        </table>
    </div>

    <script>
        const API_URL = '/students';

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
        document.addEventListener('DOMContentLoaded', loadStudents);

        async function loadStudents() {
            try {
                const response = await fetch(API_URL);
                if (!response.ok) throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—É–¥–µ–Ω—Ç–æ–≤');
                const students = await response.json();
                const tbody = document.getElementById('studentsBody');
                tbody.innerHTML = '';

                students.forEach(s => {
                    const row = tbody.insertRow();
                    row.innerHTML = `
                        <td>${s.id || ''}</td>
                        <td>${escapeHtml(s.name)}</td>
                        <td>${escapeHtml(s.groupName || '')}</td>
                        <td class="actions">
                            <button class="edit-btn" onclick="editStudent(${s.id}, '${escapeJs(s.name)}', '${escapeJs(s.groupName || '')}')">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                            <button class="delete-btn" onclick="deleteStudent(${s.id})">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
                        </td>
                    `;
                });
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
                showMessage(document.getElementById('createMessage'), '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ' + error.message, 'error');
            }
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—É–¥–µ–Ω—Ç–∞
        async function createStudent() {
            const name = document.getElementById('newName').value.trim();
            const groupName = document.getElementById('newGroup').value.trim();
            const msgEl = document.getElementById('createMessage');

            if (!name) {
                showMessage(msgEl, '–ü–æ–ª–µ "–ò–º—è" –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ', 'error');
                return;
            }

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, groupName })
                });

                if (response.ok) {
                    showMessage(msgEl, '–°—Ç—É–¥–µ–Ω—Ç –¥–æ–±–∞–≤–ª–µ–Ω!', 'success');
                    document.getElementById('newName').value = '';
                    document.getElementById('newGroup').value = '';
                    loadStudents();
                } else {
                    const errorText = await response.text();
                    showMessage(msgEl, '–û—à–∏–±–∫–∞: ' + (errorText || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è'), 'error');
                }
            } catch (error) {
                showMessage(msgEl, '–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ' + error.message, 'error');
            }
        }

        // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
        function editStudent(id, name, groupName) {
            const newName = prompt("–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –∏–º—è:", name);
            const newGroup = prompt("–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—É—é –≥—Ä—É–ø–ø—É:", groupName);

            if (newName === null || newGroup === null) return;

            const trimmedName = newName.trim();
            const trimmedGroup = newGroup.trim();

            if (!trimmedName) {
                alert('–ò–º—è –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º!');
                return;
            }

            updateStudent(id, trimmedName, trimmedGroup);
        }

        async function updateStudent(id, name, groupName) {
            try {
                const response = await fetch(`${API_URL}/${id}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ id, name, groupName })
                });

                if (response.ok) {
                    alert('–°—Ç—É–¥–µ–Ω—Ç –æ–±–Ω–æ–≤–ª—ë–Ω!');
                    loadStudents();
                } else {
                    const errorText = await response.text();
                    alert('–û—à–∏–±–∫–∞: ' + (errorText || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è'));
                }
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ' + error.message);
            }
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ
        async function deleteStudent(id) {
            if (!confirm(`–£–¥–∞–ª–∏—Ç—å —Å—Ç—É–¥–µ–Ω—Ç–∞ —Å ID ${id}?`)) return;

            try {
                const response = await fetch(`${API_URL}/${id}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    loadStudents();
                } else {
                    alert('–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å —Å—Ç—É–¥–µ–Ω—Ç–∞');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è:', error);
                alert('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏');
            }
        }

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function escapeJs(str) {
            return str.replace(/['"\\]/g, '\\$&');
        }

        function showMessage(element, text, type) {
            element.textContent = text;
            element.className = `message ${type}`;
            element.style.display = 'block';
            setTimeout(() => {
                element.style.display = 'none';
            }, 4000);
        }
    </script>
</body>
</html>